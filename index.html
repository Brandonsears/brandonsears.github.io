<!DOCTYPE html>
<html>
<head>
    <title>Market Heat Map Pro</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0b0e;
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #232323;
            margin-bottom: 20px;
        }

        .title {
            font-size: 24px;
            font-weight: 600;
            color: #ffffff;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        select {
            background: #1c1c1e;
            border: 1px solid #333;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .market-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: #1c1c1e;
            padding: 15px;
            border-radius: 8px;
            min-width: 200px;
        }

        .stat-label {
            font-size: 13px;
            color: #888;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 600;
        }

        .positive {
            color: #00ff88;
        }

        .negative {
            color: #ff4d4d;
        }

        .map-container {
            background: #1c1c1e;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .tile {
            stroke: #0a0b0e;
            stroke-width: 1px;
            transition: opacity 0.2s;
        }

        .tile:hover {
            opacity: 0.8;
        }

        .tile-label {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            fill: white;
            pointer-events: none;
        }

        #tooltip {
            position: absolute;
            background-color: #1c1c1e;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #333;
            z-index: 1000;
        }

        .tooltip-header {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .tooltip-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }

        .tooltip-label {
            color: #888;
            margin-right: 15px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: #1c1c1e;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">Market Heat Map</h1>
            <div class="controls">
                <select id="timeframe">
                    <option value="1d">1 Day</option>
                    <option value="1w">1 Week</option>
                    <option value="1m">1 Month</option>
                    <option value="1y">1 Year</option>
                </select>
                <select id="view">
                    <option value="market-cap">Market Cap</option>
                    <option value="performance">Performance</option>
                </select>
            </div>
        </div>

        <div class="market-stats">
            <div class="stat-card">
                <div class="stat-label">S&P 500</div>
                <div class="stat-value positive">4,783.45 +1.2%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">NASDAQ</div>
                <div class="stat-value negative">14,972.76 -0.8%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Market Breadth</div>
                <div class="stat-value">1.45</div>
            </div>
        </div>

        <div class="map-container">
            <div id="market-map"></div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #00ff88"></div>
                <span>Strong Gain (>2%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00aa44"></div>
                <span>Gain (0-2%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff4d4d"></div>
                <span>Loss (0-2%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #cc0000"></div>
                <span>Strong Loss (>2%)</span>
            </div>
        </div>
    </div>

    <div id="tooltip"></div>

<script>
const data = {
    children: [
        {
            name: "Technology",
            children: [
                { name: "AAPL", value: 2800, change: 2.5, price: 178.92, volume: "86.5M" },
                { name: "MSFT", value: 2300, change: -1.2, price: 402.15, volume: "22.1M" },
                { name: "GOOGL", value: 1800, change: 1.8, price: 142.65, volume: "25.3M" },
                { name: "NVDA", value: 1500, change: 3.2, price: 721.28, volume: "32.7M" }
            ]
        },
        {
            name: "Finance",
            children: [
                { name: "JPM", value: 1200, change: -0.8, price: 172.34, volume: "8.2M" },
                { name: "BAC", value: 800, change: -2.1, price: 33.47, volume: "42.1M" },
                { name: "WFC", value: 600, change: 0.5, price: 48.92, volume: "15.6M" }
            ]
        },
        {
            name: "Healthcare",
            children: [
                { name: "JNJ", value: 900, change: 1.2, price: 162.38, volume: "5.4M" },
                { name: "PFE", value: 750, change: -1.5, price: 27.43, volume: "28.9M" },
                { name: "UNH", value: 850, change: 0.8, price: 502.16, volume: "2.1M" }
            ]
        }
    ]
};

const width = 1320;
const height = 700;

const treemap = d3.treemap()
    .size([width, height])
    .padding(1);

const root = d3.hierarchy(data)
    .sum(d => d.value)
    .sort((a, b) => b.value - a.value);

treemap(root);

const svg = d3.select("#market-map")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

const getColor = (change) => {
    if (change > 2) return "#00ff88";
    if (change > 0) return "#00aa44";
    if (change > -2) return "#ff4d4d";
    return "#cc0000";
};

const formatNumber = (num) => {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
    }).format(num);
};

const cell = svg.selectAll("g")
    .data(root.leaves())
    .enter()
    .append("g")
    .attr("transform", d => `translate(${d.x0},${d.y0})`);

cell.append("rect")
    .attr("class", "tile")
    .attr("width", d => d.x1 - d.x0)
    .attr("height", d => d.y1 - d.y0)
    .attr("fill", d => getColor(d.data.change))
    .on("mouseover", function(event, d) {
        const tooltip = d3.select("#tooltip");
        tooltip.style("display", "block")
            .html(`
                <div class="tooltip-header">${d.data.name}</div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Price:</span>
                    <span>${formatNumber(d.data.price)}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Change:</span>
                    <span class="${d.data.change >= 0 ? 'positive' : 'negative'}">${d.data.change}%</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Market Cap:</span>
                    <span>${formatNumber(d.data.value)}B</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Volume:</span>
                    <span>${d.data.volume}</span>
                </div>
            `)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY + 10) + "px");
    })
    .on("mouseout", function() {
        d3.select("#tooltip").style("display", "none");
    });

cell.append("text")
    .attr("class", "tile-label")
    .attr("x", 5)
    .attr("y", 20)
    .text(d => d.data.name);

// Add event listeners for the controls
document.getElementById('timeframe').addEventListener('change', function(e) {
    // Add time frame change logic here
});

document.getElementById('view').addEventListener('change', function(e) {
    // Add view change logic here
});
</script>
</body>
</html>
